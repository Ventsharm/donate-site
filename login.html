<!doctype html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Login</title><style>body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;margin:0;background:#f6f6f6}main{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}.card{width:100%;max-width:420px;background:#fff;border-radius:18px;box-shadow:0 10px 40px rgba(0,0,0,.08);padding:22px}h1{margin:0 0 14px;font-size:40px;letter-spacing:-.5px}label{display:block;font-size:14px;margin:10px 0 6px;color:#222}input{width:100%;padding:14px 14px;border:1px solid #d8d8d8;border-radius:12px;font-size:16px;outline:none}input:focus{border-color:#111}button{width:100%;padding:14px 16px;border:0;border-radius:12px;font-size:18px;cursor:pointer;margin-top:12px}button.primary{background:#111;color:#fff}button.secondary{background:#eee;color:#111}button.pay{background:#10b981;color:#fff}small{display:block;color:#666;margin-top:10px}#msg{margin-top:14px;padding:12px;border-radius:12px;background:#fff0f0;color:#b00020;border:1px solid #ffd0d0;display:none}#ok{margin-top:14px;padding:12px;border-radius:12px;background:#ecfdf5;color:#065f46;border:1px solid #bbf7d0;display:none}#payBox{display:none;margin-top:16px;padding:14px;border-radius:14px;background:#f8fafc;border:1px solid #e5e7eb}#payBox p{margin:0 0 10px;color:#111}</style></head><body><main><div class="card"><h1>Sign in</h1><div id="ok"></div><div id="msg"></div><label>Email</label><input id="email" type="email" autocomplete="email" placeholder="you@email.com"><label>Password</label><input id="pass" type="password" autocomplete="current-password" placeholder="••••••••"><button class="primary" id="loginBtn">Login</button><button class="secondary" id="signupBtn">Create account</button><button class="secondary" id="resetBtn">Forgot password</button><div id="payBox"><p><b>Payment required.</b><br>Pay once to unlock the app.</p><button class="pay" id="payBtn">Pay £5</button><small>After payment you’ll be redirected back and unlocked.</small></div><small id="status"></small></div></main><script type="module">import{initializeApp}from"https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";import{getAuth,onAuthStateChanged,signInWithEmailAndPassword,createUserWithEmailAndPassword,sendPasswordResetEmail,signOut}from"https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";import{getFirestore,doc,getDoc}from"https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";const firebaseConfig={apiKey:"AIzaSyBMZo5HOStyDEINl2xLm-M9X4PaDc-raBQ",authDomain:"donate-app-ff07c.firebaseapp.com",projectId:"donate-app-ff07c",storageBucket:"donate-app-ff07c.firebasestorage.app",messagingSenderId:"950201336557",appId:"1:950201336557:web:e8bdfa02d99512051f82e4"};const app=initializeApp(firebaseConfig);const auth=getAuth(app);const db=getFirestore(app);const CREATE_CHECKOUT_URL="https://createcheckout-ywfufoyxmq-nw.a.run.app";const $=id=>document.getElementById(id);const show=(el,txt)=>{el.style.display="block";el.textContent=txt};const hide=el=>{el.style.display="none";el.textContent=""};const setStatus=t=>{$("status").textContent=t||""};const emailLower=s=>(s||"").trim().toLowerCase();async function isPaid(uid){const snap=await getDoc(doc(db,`users/${uid}/entitlements/access`));return snap.exists()&&snap.data()&&snap.data().paid===true}async function afterAuth(user){hide($("msg"));hide($("ok"));$("payBox").style.display="none";if(!user){setStatus("Not signed in.");return}setStatus("Checking access…");const paid=await isPaid(user.uid).catch(()=>false);if(paid){show($("ok"),"✅ Access active. Redirecting…");setStatus("");location.href="app.html"}else{show($("msg"),"You’re logged in, but you haven’t paid yet.");$("payBox").style.display="block";setStatus("Pay once to unlock.")}}onAuthStateChanged(auth,u=>{afterAuth(u)});$("loginBtn").onclick=async()=>{hide($("msg"));hide($("ok"));try{const e=emailLower($("email").value),p=$("pass").value;if(!e||!p)return show($("msg"),"Enter email and password.");await signInWithEmailAndPassword(auth,e,p);show($("ok"),"Logged in.");}catch(err){show($("msg"),err.message||String(err))}};$("signupBtn").onclick=async()=>{hide($("msg"));hide($("ok"));try{const e=emailLower($("email").value),p=$("pass").value;if(!e||!p)return show($("msg"),"Enter email and password.");await createUserWithEmailAndPassword(auth,e,p);show($("ok"),"Account created. Checking access…");}catch(err){show($("msg"),err.message||String(err))}};$("resetBtn").onclick=async()=>{hide($("msg"));hide($("ok"));try{const e=emailLower($("email").value);if(!e)return show($("msg"),"Enter your email first.");await sendPasswordResetEmail(auth,e);show($("ok"),"Password reset email sent.");}catch(err){show($("msg"),err.message||String(err))}};$("payBtn").onclick=async()=>{hide($("msg"));hide($("ok"));const user=auth.currentUser;if(!user)return show($("msg"),"Please login first.");try{setStatus("Creating checkout…");const token=await user.getIdToken(true);const r=await fetch(CREATE_CHECKOUT_URL,{method:"POST",headers:{"Content-Type":"application/json","Authorization":"Bearer "+token},body:JSON.stringify({})});const j=await r.json();if(!r.ok)throw new Error(j&&j.error?j.error:"Checkout failed");if(!j.url)throw new Error("No checkout URL returned");location.href=j.url}catch(err){show($("msg"),err.message||String(err));setStatus("")}};</script></body></html>
