<!doctype html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Login</title><style>body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:0;background:#fff}main{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}.card{width:100%;max-width:520px;background:#fff;border:1px solid rgba(0,0,0,.08);border-radius:24px;box-shadow:0 10px 40px rgba(0,0,0,.06);padding:22px}.h1{font-size:64px;line-height:1;margin:6px 0 14px;font-weight:900;letter-spacing:-1px}.msg{padding:14px 16px;border-radius:14px;margin:10px 0 14px;font-weight:600}.ok{background:#eaffef;color:#0a6b2b;border:1px solid rgba(10,107,43,.18)}.bad{background:#ffecec;color:#b00020;border:1px solid rgba(176,0,32,.18)}.info{background:#eef5ff;color:#0b3a7a;border:1px solid rgba(11,58,122,.16)}label{display:block;margin:12px 0 6px;font-weight:700}input{width:100%;padding:16px 14px;border-radius:14px;border:1px solid rgba(0,0,0,.12);font-size:18px;outline:none;background:#f5f8ff}input:focus{border-color:rgba(0,0,0,.28)}button{width:100%;padding:18px 16px;border-radius:18px;border:0;font-size:22px;font-weight:800;margin-top:14px;cursor:pointer}button.primary{background:#111;color:#fff}button.gray{background:#eee;color:#111}button.green{background:#18b67a;color:#fff}.row{display:flex;gap:12px;margin-top:10px}.row button{margin-top:0}.paybox{margin-top:18px;border:1px solid rgba(0,0,0,.10);border-radius:18px;padding:16px}.small{opacity:.75;font-size:14px;line-height:1.3;margin-top:8px}.hide{display:none!important}</style></head><body><main><div class="card"><div class="h1">Sign in</div><div id="status" class="msg info">Loading…</div><label>Email</label><input id="email" type="email" placeholder="you@email.com" autocomplete="email"><label>Password</label><input id="pass" type="password" placeholder="••••••••" autocomplete="current-password"><button id="loginBtn" class="primary">Login</button><div class="row"><button id="signupBtn" class="gray">Create account</button><button id="resetBtn" class="gray">Forgot password</button></div><div id="payWrap" class="paybox hide"><div style="font-weight:900;font-size:20px;margin-bottom:2px">Payment required.</div><div style="font-weight:700;opacity:.8">Pay once to unlock the app.</div><button id="payBtn" class="green" style="margin-top:14px">Pay £5</button><div class="small">After payment you’ll be redirected back. If you see “Payment received”, just tap “Back to login” then log in again.</div></div></div></main><script type="module">import{initializeApp}from"https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";import{getAuth,setPersistence,browserLocalPersistence,onAuthStateChanged,signInWithEmailAndPassword,createUserWithEmailAndPassword,sendPasswordResetEmail}from"https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";import{getFirestore,doc,getDoc}from"https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";const firebaseConfig={apiKey:"AIzaSyBMZo5HOStyDEINl2xLm-M9X4PaDc-raBQ",authDomain:"donate-app-ff07c.firebaseapp.com",projectId:"donate-app-ff07c",storageBucket:"donate-app-ff07c.firebasestorage.app",messagingSenderId:"950201336557",appId:"1:950201336557:web:e8bdfa02d99512051f82e4"};const app=initializeApp(firebaseConfig),auth=getAuth(app),db=getFirestore(app);const CREATE_CHECKOUT_URL="https://createcheckout-ywfufoyxmq-nw.a.run.app";const $=id=>document.getElementById(id);const statusEl=$("status"),payWrap=$("payWrap");const setMsg=(txt,type)=>{statusEl.className="msg "+type;statusEl.textContent=txt};const setPayVisible=v=>payWrap.classList.toggle("hide",!v);await setPersistence(auth,browserLocalPersistence).catch(()=>{});async function checkPaidAndRoute(user){setPayVisible(false);setMsg("Checking access…","info");try{const snap=await getDoc(doc(db,"users",user.uid,"access","access"));const paid=!!(snap.exists()&&snap.data()&&snap.data().paid===true);if(paid){setMsg("Access confirmed. Redirecting…","ok");location.href="app.html";return}else{setMsg("You’re logged in, but you haven’t paid yet.","bad");setPayVisible(true);return}}catch(e){setMsg("Couldn’t check access: "+(e&&e.message?e.message:"Error"),"bad");setPayVisible(true)}}onAuthStateChanged(auth,user=>{if(!user){setMsg("Not logged in.","ok");setPayVisible(true);return}checkPaidAndRoute(user)});$("loginBtn").onclick=async()=>{setMsg("Signing in…","info");try{await signInWithEmailAndPassword(auth,$("email").value.trim(),$("pass").value);setMsg("Signed in. Checking access…","info")}catch(e){setMsg(e&&e.message?e.message:"Login failed","bad")}};$("signupBtn").onclick=async()=>{setMsg("Creating account…","info");try{await createUserWithEmailAndPassword(auth,$("email").value.trim(),$("pass").value);setMsg("Account created. Checking access…","info")}catch(e){setMsg(e&&e.message?e.message:"Sign up failed","bad")}};$("resetBtn").onclick=async()=>{const email=$("email").value.trim();if(!email){setMsg("Type your email first.","bad");return}setMsg("Sending reset email…","info");try{await sendPasswordResetEmail(auth,email);setMsg("Reset email sent.","ok")}catch(e){setMsg(e&&e.message?e.message:"Reset failed","bad")}};$("payBtn").onclick=async()=>{const user=auth.currentUser;if(!user){setMsg("Please log in first, then pay.","bad");return}setMsg("Opening Stripe checkout…","info");try{const token=await user.getIdToken(true);const r=await fetch(CREATE_CHECKOUT_URL,{method:"POST",headers:{"Content-Type":"application/json","Authorization":"Bearer "+token},body:JSON.stringify({})});if(!r.ok){throw new Error("Checkout error ("+r.status+")")}const data=await r.json();if(!data||!data.url)throw new Error("No checkout URL returned");location.href=data.url}catch(e){setMsg(e&&e.message?e.message:"Failed to start checkout","bad")}};</script></body></html>
