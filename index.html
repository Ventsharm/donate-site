<!-- PART 1/3 -->
<!doctype html><html lang="en"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Donate Site</title><meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"/><meta http-equiv="Pragma" content="no-cache"/><meta http-equiv="Expires" content="0"/><style>:root{--bg:#f3f6ff;--card:#fff;--text:#0b1320;--muted:#52607a;--line:rgba(0,0,0,.10);--pill:#f1f6ff;--btn:#0b0b0d;--ok:#eafff1;--okText:#0f6b2f;--err:#ffecec;--errText:#a01414;--warn:#fff1f2;--warnText:#9f1239;--green:#19c37d}*{box-sizing:border-box}html,body{height:100%}body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--text)}.wrap{min-height:100%;display:flex;align-items:center;justify-content:center;padding:22px}.card{width:min(560px,100%);background:var(--card);border:1px solid rgba(0,0,0,.08);border-radius:24px;box-shadow:0 16px 55px rgba(0,0,0,.10);padding:22px}.h1{font-size:54px;line-height:1;margin:0 0 10px;font-weight:900;letter-spacing:-1px}.sub{margin:0 0 14px;color:#3d4a63;font-weight:650}.msg{display:none;margin:12px 0 16px;padding:12px 14px;border-radius:14px;border:1px solid rgba(0,0,0,.08);background:#f6f8ff;color:#1e2a44;font-weight:800;white-space:pre-wrap;word-break:break-word}.msg[data-type="ok"]{background:var(--ok);color:var(--okText)}.msg[data-type="warn"]{background:var(--warn);color:var(--warnText)}.msg[data-type="err"]{background:var(--err);color:var(--errText)}.row{display:grid;gap:10px;margin:12px 0}label{font-weight:900;color:#1e2a44}.in{width:100%;padding:14px 14px;border-radius:14px;border:1px solid rgba(0,0,0,.14);background:var(--pill);font-size:16px;outline:none}textarea.in{min-height:120px;resize:vertical}.btn{width:100%;padding:15px 16px;border-radius:16px;border:0;font-size:18px;font-weight:900;cursor:pointer}.btnPrimary{background:var(--btn);color:#fff;box-shadow:0 10px 25px rgba(0,0,0,.18)}.btnGhost{background:#eef1f6;color:var(--text)}.btnGreen{background:var(--green);color:#062a19;box-shadow:0 12px 30px rgba(25,195,125,.25)}.btnDanger{background:#fee2e2;color:#991b1b}.topRow{display:flex;align-items:flex-start;justify-content:space-between;gap:12px}.rightActions{display:flex;gap:10px;align-items:center;justify-content:flex-end;flex-wrap:wrap}.smallBtn{background:#eef1f6;border:0;border-radius:14px;padding:10px 12px;font-weight:900;cursor:pointer;color:var(--text)}.linkBtn{background:transparent;border:0;color:#1b4dd8;font-weight:900;font-size:18px;cursor:pointer;padding:8px 0}.hr{height:1px;background:rgba(0,0,0,.08);margin:14px 0}.pillOk{padding:12px 14px;border-radius:14px;border:1px solid rgba(0,0,0,.08);background:var(--ok);color:var(--okText);font-weight:900}.muted{margin:10px 0 0;color:var(--muted);font-weight:650}.tiny{margin-top:10px;color:#5d6b86;font-size:13px;line-height:1.35}.linkBox{margin-top:12px;padding:12px 14px;border-radius:14px;border:1px solid rgba(0,0,0,.10);background:#f6f8ff;font-weight:800;word-break:break-all}.center{text-align:center}#bootCover{display:block}#loginWrap,#verifyWrap,#editorWrap,#publicWrap{display:none}.publicTitle{font-size:48px;line-height:1.05;margin:0 0 8px;font-weight:950;letter-spacing:-1px}.publicAbout{margin:0 0 14px;color:#334155;font-weight:650;white-space:pre-wrap}.box{border:1px solid var(--line);border-radius:18px;padding:16px;background:#fff}.boxTitle{font-size:22px;margin:0 0 6px;font-weight:900}.signedIn{margin:10px 0 12px;padding:12px 14px;border-radius:14px;border:1px solid rgba(0,0,0,.08);background:#f6f8ff;color:#1e2a44;font-weight:900;word-break:break-word}@media(max-width:420px){.h1{font-size:44px}.publicTitle{font-size:42px}}</style></head><body><div class="wrap"><div class="card"><div class="topRow"><div><h1 id="headerTitle" class="h1">Sign in</h1><p id="headerSub" class="sub">Create or sign in to manage your campaign.</p></div><div class="rightActions"><button id="switchUserBtn" class="smallBtn" type="button" style="display:none">Use different account</button><button id="logoutBtn" class="linkBtn" type="button" style="display:none">Logout</button></div></div><div id="statusBox" class="msg"></div><div id="bootCover" class="msg" data-type="ok" style="display:block">Loading…</div><div id="loginWrap"><div class="row"><label for="email">Email</label><input id="email" class="in" type="email" autocomplete="email" placeholder="you@email.com"/></div><div class="row"><label for="password">Password</label><input id="password" class="in" type="password" autocomplete="current-password" placeholder="••••••••"/></div><button id="loginBtn" class="btn btnPrimary" type="button">Login</button><div style="height:12px"></div><div class="grid2" style="display:grid;grid-template-columns:1fr 1fr;gap:12px"><button id="createBtn" class="btn btnGhost" type="button">Create account</button><button id="forgotBtn" class="btn btnGhost" type="button">Forgot password</button></div><p class="tiny">Tip: If you don’t have an account yet, tap <b>Create account</b>.</p></div><div id="verifyWrap"><div class="pillOk">One last step ✅</div><p class="muted" style="margin-top:10px">We’ve sent a verification email. Open it and tap the link, then come back here.</p><div style="height:12px"></div><button id="resendBtn" class="btn btnGhost" type="button">Resend verification email</button><div style="height:12px"></div><button id="checkVerifiedBtn" class="btn btnPrimary" type="button">I verified — Continue</button><p class="tiny">If you can’t find it, check spam/junk.</p></div><div id="editorWrap"><div class="pillOk">Ready ✅</div><div id="signedInBox" class="signedIn" style="display:none"></div><p id="editorHint" class="muted">Edit your campaign, connect Stripe, then share your public page.</p><div class="hr"></div><div class="box" style="margin-bottom:12px"><div class="boxTitle">Stripe Connect</div><p class="sub" style="margin:0 0 12px">Connect your Stripe account so donations can go directly to you.</p><button id="connectBtn" class="btn btnPrimary" type="button">Connect Stripe</button><p class="tiny" style="margin:10px 0 0">If you’re already connected, tapping this can open Stripe onboarding/manage again.</p></div><div class="row"><label for="campTitle">Campaign title</label><input id="campTitle" class="in" placeholder="e.g. Help with rent"/></div><div class="row"><label for="campAbout">About (why you need donations)</label><textarea id="campAbout" class="in" placeholder="Write a short explanation…"></textarea></div><div style="height:10px"></div><button id="saveBtn" class="btn btnPrimary" type="button">Save campaign</button><div style="height:10px"></div><button id="deleteCampaignBtn" class="btn btnGhost" type="button">Delete campaign</button><div style="height:10px"></div><button id="copyBtn" class="btn btnGhost" type="button">Copy public link</button><div id="publicLinkBox" class="linkBox"></div><div style="height:10px"></div><button id="deleteAccountBtn" class="btn btnDanger" type="button">Delete account</button></div><div id="publicWrap"><h2 id="pTitle" class="publicTitle"></h2><p id="pAbout" class="publicAbout"></p><div class="box"><div class="boxTitle">Donate</div><p class="sub" style="margin:0 0 12px">Enter an amount, then pay securely.</p><div class="row" style="margin-top:0"><label for="donationAmount">Amount (£)</label><input id="donationAmount" class="in" inputmode="decimal" placeholder="e.g. 7.50"/></div><button id="donateBtn" class="btn btnGreen" type="button">Donate</button><div class="tiny">Payments are processed securely by Stripe.</div></div><div class="center" style="margin-top:14px"><button id="backHomeBtn" class="btn btnGhost" type="button">Back</button></div></div><div class="tiny center" id="buildTag"></div></div></div>
<script type="module">import{initializeApp}from"https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";import{getAuth,onAuthStateChanged,signInWithEmailAndPassword,createUserWithEmailAndPassword,sendPasswordResetEmail,signOut,setPersistence,browserLocalPersistence,sendEmailVerification,deleteUser,reauthenticateWithCredential,EmailAuthProvider}from"https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";import{getFirestore,doc,getDoc,setDoc,deleteDoc}from"https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";const firebaseConfig={apiKey:"AIzaSyBMZo5HOStyDEINl2xLm-M9X4PaDc-raBQ",authDomain:"donate-app-ff07c.firebaseapp.com",projectId:"donate-app-ff07c",storageBucket:"donate-app-ff07c.firebasestorage.app",messagingSenderId:"950201336557",appId:"1:950201336557:web:e8bdfa02d99512051f82e4"};const CREATE_DONATION_CHECKOUT_URL="https://europe-west2-donate-app-ff07c.cloudfunctions.net/createDonationCheckout";const CREATE_CONNECT_LINK_URL="https://europe-west2-donate-app-ff07c.cloudfunctions.net/createConnectLink";const app=initializeApp(firebaseConfig),auth=getAuth(app),db=getFirestore(app);try{setPersistence(auth,browserLocalPersistence)}catch(_){}const el=id=>document.getElementById(id);const headerTitle=el("headerTitle"),headerSub=el("headerSub"),statusBox=el("statusBox"),bootCover=el("bootCover");const loginWrap=el("loginWrap"),verifyWrap=el("verifyWrap"),editorWrap=el("editorWrap"),publicWrap=el("publicWrap");const emailEl=el("email"),passEl=el("password");const loginBtn=el("loginBtn"),createBtn=el("createBtn"),forgotBtn=el("forgotBtn");const logoutBtn=el("logoutBtn"),switchUserBtn=el("switchUserBtn");const resendBtn=el("resendBtn"),checkVerifiedBtn=el("checkVerifiedBtn");const campTitle=el("campTitle"),campAbout=el("campAbout");const saveBtn=el("saveBtn"),copyBtn=el("copyBtn"),deleteCampaignBtn=el("deleteCampaignBtn"),deleteAccountBtn=el("deleteAccountBtn"),publicLinkBox=el("publicLinkBox");const connectBtn=el("connectBtn");const pTitle=el("pTitle"),pAbout=el("pAbout"),donateBtn=el("donateBtn"),backHomeBtn=el("backHomeBtn"),buildTag=el("buildTag"),donationAmount=el("donationAmount");const signedInBox=el("signedInBox");buildTag.textContent="build: "+new Date().toISOString().slice(0,16).replace("T"," ");const show=(n,on)=>{if(n)n.style.display=on?"block":"none"};const setMsg=(t,type="info")=>{statusBox.textContent=t||"";statusBox.style.display=t?"block":"none";statusBox.dataset.type=type};const disable=(b,on)=>{if(!b)return;b.disabled=!!on;b.style.opacity=on?".7":"1";b.style.cursor=on?"not-allowed":"pointer"};const safeEmail=()=>String(emailEl.value||"").trim();const safePass=()=>String(passEl.value||"");const qs=new URLSearchParams(location.search);const campaignId=qs.get("c");const campaignRef=uid=>doc(db,"campaigns",uid);const publicUrlFor=uid=>{const base=location.origin+location.pathname.replace(/\/index(\.html)?$/,"/");return base+(base.includes("?")?"&":"?")+"c="+encodeURIComponent(uid)};function setHeader(mode){if(mode==="login"){headerTitle.textContent="Sign in";headerSub.textContent="Create or sign in to manage your campaign."}else if(mode==="verify"){headerTitle.textContent="Verify email";headerSub.textContent="Please verify your email to continue."}else if(mode==="editor"){headerTitle.textContent="Your campaign";headerSub.textContent="Edit your campaign, connect Stripe, then share your public page."}else if(mode==="public"){headerTitle.textContent="";headerSub.textContent=""}headerTitle.style.display=mode==="public"?"none":"block";headerSub.style.display=mode==="public"?"none":"block"}function setMode(mode){show(bootCover,false);show(loginWrap,mode==="login");show(verifyWrap,mode==="verify");show(editorWrap,mode==="editor");show(publicWrap,mode==="public");show(logoutBtn,mode==="editor"||mode==="verify");show(switchUserBtn,mode==="editor"||mode==="verify");setHeader(mode)}async function loadPublic(){setMode("public");setMsg("","info");try{const snap=await getDoc(campaignRef(campaignId));if(!snap.exists()){setMsg("This campaign was not found.","err");pTitle.textContent="Campaign not found";pAbout.textContent="";donateBtn.style.display="none";return}const d=snap.data()||{};pTitle.textContent=(d.title||"Campaign").trim();pAbout.textContent=(d.about||"").trim();donateBtn.style.display="block"}catch(err){setMsg("Failed to load campaign.\n"+(err?.message||err),"err")}}async function loadEditor(user){setMode("editor");setMsg("","info");publicLinkBox.textContent=publicUrlFor(user.uid);if(signedInBox){signedInBox.textContent="Signed in as "+(user.email||"");show(signedInBox,true)}try{const snap=await getDoc(campaignRef(user.uid));const d=snap.exists()?snap.data():{};campTitle.value=d?.title||"";campAbout.value=d?.about||""}catch(err){setMsg("Couldn’t load your campaign.\n"+(err?.message||err),"err")}}async function fetchJson(url,bodyObj){const headers={"Content-Type":"application/json"};const bodyText=JSON.stringify(bodyObj||{});const res=await fetch(url,{method:"POST",mode:"cors",headers,body:bodyText});const text=await res.text();let data=null;try{data=text?JSON.parse(text):null}catch(_){data=null}return{res,data,text}}async function postSmartPublic(url,payload){let out=await fetchJson(url,payload);if(out.res.ok){const d=out.data||{};return{data:d,url:d.url||d?.result?.url||""}}let msg=((out.data&&(out.data.error||out.data.message))?String(out.data.error||out.data.message):("HTTP "+out.res.status))||"Error";if(String(msg).toLowerCase().includes("missing")||String(msg).toLowerCase().includes("data")||out.res.status===400||out.res.status===500){out=await fetchJson(url,{data:payload||{}});if(out.res.ok){const d2=out.data||{};return{data:d2,url:d2.url||d2?.result?.url||""}}msg=((out.data&&(out.data.error||out.data.message))?String(out.data.error||out.data.message):("HTTP "+out.res.status))||"Error";if(String(msg).toLowerCase().includes("missing")||String(msg).toLowerCase().includes("data")||out.res.status===400||out.res.status===500){out=await fetchJson(url,{data:{data:payload||{}}});if(out.res.ok){const d3=out.data||{};return{data:d3,url:d3.url||d3?.result?.url||""}}msg=((out.data&&(out.data.error||out.data.message))?String(out.data.error||out.data.message):("HTTP "+out.res.status))||"Error"}throw new Error(msg)}throw new Error(msg)}async function postSmartAuthed(url,user,payload){const idToken=await user.getIdToken(true);const headers={"Content-Type":"application/json","Authorization":"Bearer "+idToken};let res=await fetch(url,{method:"POST",mode:"cors",headers,body:JSON.stringify(payload||{})});let text=await res.text();let data=null;try{data=text?JSON.parse(text):null}catch(_){data=null}if(res.ok)return{data,url:(data&&(data.url||data?.result?.url))||""};let msg=((data&&(data.error||data.message))?String(data.error||data.message):("HTTP "+res.status))||"Error";if(String(msg).toLowerCase().includes("missing")||String(msg).toLowerCase().includes("data")||res.status===400||res.status===500){res=await fetch(url,{method:"POST",mode:"cors",headers,body:JSON.stringify({data:payload||{}})});text=await res.text();data=null;try{data=text?JSON.parse(text):null}catch(_){data=null}if(res.ok)return{data,url:(data&&(data.url||data?.result?.url))||""};msg=((data&&(data.error||data.message))?String(data.error||data.message):("HTTP "+res.status))||"Error"}throw new Error(msg)}function parseGBPToPence(s){let t=String(s||"").trim().replace(/,/g,".");if(!t)return 0;if(!/^\d+(\.\d{1,2})?$/.test(t))return NaN;const parts=t.split(".");const pounds=parseInt(parts[0]||"0",10)||0;const pennies=parseInt((parts[1]||"0").padEnd(2,"0").slice(0,2),10)||0;return pounds*100+pennies}donationAmount&&donationAmount.addEventListener("input",()=>{const p=parseGBPToPence(donationAmount.value);if(!isFinite(p)||p<=0){donateBtn.textContent="Donate";return}const gbp=(p/100).toFixed(p%100===0?0:2);donateBtn.textContent="Donate £"+gbp});
donateBtn&&donateBtn.addEventListener("click",async()=>{try{disable(donateBtn,true);setMsg("Creating checkout…","ok");const p=parseGBPToPence(donationAmount.value);if(!isFinite(p)||p<=0){setMsg("Enter a valid amount (e.g. 5 or 7.50).","warn");disable(donateBtn,false);return}const here=location.href;const cid=campaignId||"";const payload={amount:p,amount_pence:p,donationAmount:p,currency:"gbp",currencyCode:"gbp",campaignId:cid,campaignID:cid,campaignUid:cid,creatorUid:cid,uid:cid,successUrl:here,cancelUrl:here,returnUrl:here,success_url:here,cancel_url:here,return_url:here};const r=await postSmartPublic(CREATE_DONATION_CHECKOUT_URL,payload);const url=String(r.url||"");if(!url)throw new Error("No URL returned");location.href=url}catch(err){setMsg("Checkout error:\n"+(err?.message||err),"err");disable(donateBtn,false)}});connectBtn&&connectBtn.addEventListener("click",async()=>{const u=auth.currentUser;if(!u){setMsg("Not logged in.","err");return}try{disable(connectBtn,true);setMsg("Opening Stripe Connect…","ok");const returnBase=location.origin+location.pathname.replace(/\/index(\.html)?$/,"/");const payload={returnUrl:returnBase,refreshUrl:returnBase,successUrl:returnBase,cancelUrl:returnBase};const r=await postSmartAuthed(CREATE_CONNECT_LINK_URL,u,payload);const url=String(r.url||"");if(!url)throw new Error("No URL returned");location.href=url}catch(err){setMsg("Connect failed:\n"+(err?.message||err),"err");disable(connectBtn,false)}});loginBtn.addEventListener("click",async()=>{try{disable(loginBtn,true);disable(createBtn,true);disable(forgotBtn,true);setMsg("Signing in…","ok");await signInWithEmailAndPassword(auth,safeEmail(),safePass())}catch(err){const code=String(err?.code||"");if(code.includes("auth/invalid-credential")||code.includes("auth/user-not-found")||code.includes("auth/wrong-password"))setMsg("Account not found or wrong password.\nIf you’re new, tap “Create account”.","err");else setMsg(err?.message||"Login failed.","err")}finally{disable(loginBtn,false);disable(createBtn,false);disable(forgotBtn,false)}});createBtn.addEventListener("click",async()=>{try{disable(loginBtn,true);disable(createBtn,true);disable(forgotBtn,true);setMsg("Creating account…","ok");const cred=await createUserWithEmailAndPassword(auth,safeEmail(),safePass());try{await sendEmailVerification(cred.user)}catch(_){ }setMsg("Account created ✅\nWe sent a verification email. Please verify, then tap “I verified — Continue”.","ok")}catch(err){const code=String(err?.code||"");if(code.includes("auth/email-already-in-use"))setMsg("That email already has an account.\nTap “Login” instead.","err");else setMsg(err?.message||"Create account failed.","err")}finally{disable(loginBtn,false);disable(createBtn,false);disable(forgotBtn,false)}});forgotBtn.addEventListener("click",async()=>{try{const em=safeEmail();if(!em){setMsg("Enter your email first.","warn");return}disable(loginBtn,true);disable(createBtn,true);disable(forgotBtn,true);setMsg("Sending reset email…","ok");await sendPasswordResetEmail(auth,em);setMsg("Password reset email sent ✅","ok")}catch(err){setMsg(err?.message||"Reset failed.","err")}finally{disable(loginBtn,false);disable(createBtn,false);disable(forgotBtn,false)}});logoutBtn.addEventListener("click",async()=>{try{await signOut(auth)}catch(_){ }});switchUserBtn.addEventListener("click",async()=>{try{await signOut(auth)}catch(_){ }emailEl.value="";passEl.value="";setMsg("Ready for a different account.","ok")});resendBtn.addEventListener("click",async()=>{try{const u=auth.currentUser;if(!u){setMsg("Not logged in.","err");return}await sendEmailVerification(u);setMsg("Verification email re-sent ✅","ok")}catch(err){setMsg(err?.message||"Could not resend.","err")}});checkVerifiedBtn.addEventListener("click",async()=>{try{const u=auth.currentUser;if(!u){setMsg("Not logged in.","err");return}await u.reload();if(u.emailVerified){setMsg("Verified ✅ Loading your campaign…","ok");await loadEditor(u)}else setMsg("Still not verified.\nOpen the email and tap the verification link, then try again.","warn")}catch(err){setMsg(err?.message||"Could not check verification.","err")}});saveBtn&&saveBtn.addEventListener("click",async()=>{try{const u=auth.currentUser;if(!u){setMsg("Not logged in.","err");return}disable(saveBtn,true);disable(copyBtn,true);disable(deleteCampaignBtn,true);disable(deleteAccountBtn,true);setMsg("Saving…","ok");await setDoc(campaignRef(u.uid),{title:String(campTitle.value||"").trim(),about:String(campAbout.value||"").trim(),updatedAt:Date.now()},{merge:true});setMsg("Saved ✅","ok")}catch(err){setMsg("Save failed.\n"+(err?.message||err),"err")}finally{disable(saveBtn,false);disable(copyBtn,false);disable(deleteCampaignBtn,false);disable(deleteAccountBtn,false)}});copyBtn&&copyBtn.addEventListener("click",async()=>{try{const u=auth.currentUser;if(!u){setMsg("Not logged in.","err");return}const url=publicUrlFor(u.uid);if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(url);else throw new Error("Clipboard not available");setMsg("Public link copied ✅","ok")}catch(_){setMsg("Could not copy automatically.\nTap and hold the link to copy it.","warn")}});deleteCampaignBtn&&deleteCampaignBtn.addEventListener("click",async()=>{try{const u=auth.currentUser;if(!u){setMsg("Not logged in.","err");return}if(!confirm("Delete your campaign? This removes the public page content."))return;disable(saveBtn,true);disable(copyBtn,true);disable(deleteCampaignBtn,true);disable(deleteAccountBtn,true);setMsg("Deleting campaign…","ok");await deleteDoc(campaignRef(u.uid));campTitle.value="";campAbout.value="";setMsg("Campaign deleted ✅ (your public page will show ‘not found’)","ok")}catch(err){setMsg("Delete failed.\n"+(err?.message||err),"err")}finally{disable(saveBtn,false);disable(copyBtn,false);disable(deleteCampaignBtn,false);disable(deleteAccountBtn,false)}});async function deleteAllKnownUserData(uid){await Promise.allSettled([deleteDoc(campaignRef(uid))])}async function doReauthIfNeeded(u){const pw=prompt("For security, enter your password to delete your account:");if(!pw)throw new Error("Password required to delete account.");const cred=EmailAuthProvider.credential(u.email,pw);await reauthenticateWithCredential(u,cred)}deleteAccountBtn&&deleteAccountBtn.addEventListener("click",async()=>{try{const u=auth.currentUser;if(!u){setMsg("Not logged in.","err");return}if(!confirm("Delete your account?\n\nThis permanently deletes:\n• your campaign\n• your login account\n\nThis cannot be undone."))return;disable(saveBtn,true);disable(copyBtn,true);disable(deleteCampaignBtn,true);disable(deleteAccountBtn,true);setMsg("Deleting account…","warn");await deleteAllKnownUserData(u.uid);try{await deleteUser(u)}catch(e){const code=String(e?.code||"");if(code.includes("auth/requires-recent-login")){await doReauthIfNeeded(u);await deleteUser(u)}else throw e}setMsg("Account deleted ✅","ok");setTimeout(()=>{location.href=location.origin+location.pathname.replace(/\/index(\.html)?$/,"/")},600)}catch(err){setMsg((err&&err.message)?err.message:("Delete account failed.\n"+(err?.message||err)),"err")}finally{disable(saveBtn,false);disable(copyBtn,false);disable(deleteCampaignBtn,false);disable(deleteAccountBtn,false)}});backHomeBtn&&backHomeBtn.addEventListener("click",()=>{location.href=location.origin+location.pathname.replace(/\/index(\.html)?$/,"/")});setMsg("","info");if(campaignId){setMode("public");show(bootCover,true);loadPublic()}else{setMode("login");show(bootCover,true)}onAuthStateChanged(auth,async(user)=>{if(campaignId)return;try{if(!user){setMode("login");setMsg("","info");return}await user.reload();if(!user.emailVerified){setMode("verify");setMsg("Please verify your email to continue.","warn");return}await loadEditor(user)}catch(err){setMode("login");setMsg("Startup error:\n"+(err?.message||err),"err")}});</script></body></html>
