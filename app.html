<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Your account</title><style>:root{--bg:#f5f6fb;--card:#fff;--text:#111827;--muted:#6b7280;--line:#e5e7eb;--ok:#16a34a;--bad:#dc2626;--info:#2563eb;--btn:#111;--pay:#10b981}*{box-sizing:border-box}body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--text)}.wrap{min-height:100vh;display:flex;align-items:flex-start;justify-content:center;padding:24px}.card{width:min(620px,100%);background:var(--card);border:1px solid var(--line);border-radius:24px;box-shadow:0 14px 50px rgba(0,0,0,.08);padding:22px 18px;margin-top:8px}.h1{font-size:52px;letter-spacing:-.04em;margin:4px 6px 14px;font-weight:1000}.status{margin:10px 6px 14px;border-radius:14px;padding:14px 14px;font-weight:800;border:1px solid var(--line);background:#f8fafc}.status.ok{background:#ecfdf5;border-color:#bbf7d0;color:#065f46}.status.bad{background:#fef2f2;border-color:#fecaca;color:#7f1d1d}.status.info{background:#eff6ff;border-color:#bfdbfe;color:#1e3a8a}.btn{width:100%;padding:16px 16px;border-radius:18px;border:1px solid #000;background:linear-gradient(180deg,#1f2937,#000);color:#fff;font-size:18px;font-weight:1000;cursor:pointer;margin:10px 0}.btn2{width:100%;padding:14px;border-radius:18px;border:1px solid var(--line);background:#f3f4f6;font-weight:1000;font-size:18px;cursor:pointer;margin:10px 0}.paybtn{width:100%;padding:18px;border-radius:22px;border:0;background:linear-gradient(180deg,#34d399,#10b981);color:#fff;font-size:26px;font-weight:1000;cursor:pointer;margin:10px 0}.box{border:1px solid var(--line);border-radius:18px;padding:14px;margin:10px 6px;background:#fff}.muted{color:var(--muted);margin:6px 0 0;font-size:14px;line-height:1.35}.hide{display:none!important}@media(max-width:520px){.h1{font-size:44px}}</style></head><body><div class="wrap"><div class="card"><div class="h1">Your account</div><div id="status" class="status info">Checking access…</div><div id="unlocked" class="box hide"><div style="font-weight:1000;font-size:20px;margin-bottom:6px">✅ Access granted</div><div class="muted">You’re paid and unlocked. Put your real app content here.</div><button id="logoutBtn" class="btn2">Logout</button></div><div id="locked" class="box hide"><div style="font-weight:1000;font-size:20px;margin-bottom:6px">Payment required</div><div class="muted">You’re logged in, but not paid yet.</div><button id="payBtn" class="paybtn">Pay £5</button><button id="logoutBtn2" class="btn2">Logout</button></div></div></div><script type="module">import{initializeApp}from"https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";import{getAuth,setPersistence,browserLocalPersistence,onAuthStateChanged,signOut}from"https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";import{getFirestore,doc,getDoc}from"https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";const firebaseConfig={apiKey:"AIzaSyBMZo5HOStyDEINl2xLm-M9X4PaDc-raBQ",authDomain:"donate-app-ff07c.firebaseapp.com",projectId:"donate-app-ff07c",storageBucket:"donate-app-ff07c.firebasestorage.app",messagingSenderId:"950201336557",appId:"1:950201336557:web:e8bdfa02d99512051f82e4"};const CREATE_CHECKOUT_URL="https://europe-west2-donate-app-ff07c.cloudfunctions.net/createCheckout";const app=initializeApp(firebaseConfig);const auth=getAuth(app);const db=getFirestore(app);const $=id=>document.getElementById(id);const statusEl=$("status"),unlocked=$("unlocked"),locked=$("locked"),payBtn=$("payBtn"),logoutBtn=$("logoutBtn"),logoutBtn2=$("logoutBtn2");let ran=false;function setMsg(t,type){statusEl.className="status "+(type||"info");statusEl.textContent=t}function show(el){el.classList.remove("hide")}function hide(el){el.classList.add("hide")}async function isPaid(user){const snapA=await getDoc(doc(db,"users",user.uid,"access","access"));if(snapA.exists()&&snapA.data()&&snapA.data().paid===true)return true;const snapB=await getDoc(doc(db,"users",user.uid));if(snapB.exists()&&snapB.data()&&snapB.data().paid===true)return true;return false}async function startCheckout(user){setMsg("Starting checkout…","info");try{const token=await user.getIdToken(true);const r=await fetch(CREATE_CHECKOUT_URL,{method:"POST",headers:{"Content-Type":"application/json","Authorization":"Bearer "+token},body:JSON.stringify({})});if(!r.ok){const t=await r.text().catch(()=>"" );throw new Error("Checkout error ("+r.status+"): "+t)}const data=await r.json();if(!data||!data.url)throw new Error("No checkout URL returned");location.href=data.url}catch(e){setMsg(e&&e.message?e.message:"Checkout failed","bad")}}async function boot(user){hide(unlocked);hide(locked);if(!user){setMsg("Not logged in. Returning to login…","bad");setTimeout(()=>location.href="login.html",400);return}setMsg("Checking access…","info");try{const paid=await isPaid(user);if(paid){setMsg("Access confirmed.","ok");show(unlocked)}else{setMsg("You’re logged in, but you haven’t paid yet.","bad");show(locked)}}catch(e){setMsg("Access check failed: "+(e&&e.message?e.message:"Error"),"bad");show(locked)}}logoutBtn.onclick=logoutBtn2.onclick=async()=>{await signOut(auth);location.href="login.html"};payBtn.onclick=async()=>{const u=auth.currentUser;if(!u){setMsg("Please login again.","bad");location.href="login.html";return}await startCheckout(u)};await setPersistence(auth,browserLocalPersistence).catch(()=>{});onAuthStateChanged(auth,user=>{if(ran)return;ran=true;boot(user)});</script></body></html>
